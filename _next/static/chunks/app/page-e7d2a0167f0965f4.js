(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{741:(e,t,a)=>{Promise.resolve().then(a.bind(a,4567))},4567:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>eR});var s=a(5155),n=a(2115),r=a(6472),i=a(5781);let l={rebalanceLTV:.88,rebalancingBounty:.025,liquidationLTV:.95,openingFee:.003,closingFee:.001},o={xPositionValue:1e4,openingPrice:2e3,leverage:4},c=(e,t)=>e*(t-1),d=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.openingFee;return e-e*a+t},m=(e,t,a)=>e*(t-1)/(t*a),x=(e,t,a)=>e*(t-1)/(t*a),u=e=>e,p=(e,t)=>e-t,b=(e,t,a,s)=>e.wasRebalanced?u(e.lastRebalancePrice):m(t,a,s),f=(e,t,a,s,n)=>e.wasRebalanced&&void 0!==n?p(e.rebalanceLine,n):x(t,a,s),h=(e,t,a,s)=>Array.from({length:s},(a,n)=>e+t*Math.sin(n/(s-1)*2*Math.PI)),g=(e,t)=>e/t,N=(e,t)=>e*t,v=(e,t,a,s,n,r)=>{let i;let l=c(e,t),o=null!=n?n:l,m=N(i=r||g(d(e,l),s),a);return{initialDebt:l,debt:o,positionSize:m,ethAmount:i,xPositionValue:m-o}},j=(e,t,a)=>m(e,t,a.rebalanceLTV)-x(e,t,a.liquidationLTV),w=(e,t,a,s)=>{let n;let r=j(t,a,s),i=b(e,t,a,s.rebalanceLTV);return n=e.wasRebalanced?i-r:x(t,a,s.liquidationLTV),{...e,rebalanceLine:i,liquidationLine:n}},y=e=>(.01>Math.abs(e)&&(e=0),new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(e)),z=(e,t,a,s)=>{if(t/e<=a)return{debtToRebalance:0,newDebt:t,newPositionSize:e,rebalancingFee:0};let n=(t-e*a)/(1-(1+s)*a),r=Math.min(n*s,e-n);return{debtToRebalance:n,newDebt:t-n,newPositionSize:e-(n+r),rebalancingFee:r}},k=(e,t,a,s)=>{let{debtToRebalance:n,newDebt:r,newPositionSize:i,rebalancingFee:l}=z(e.positionSize,e.debt,a,s);return{...e,debt:r,positionSize:i,ethAmount:i/t,xPositionValue:i-r,wasRebalanced:!0,rebalancingAmount:n+l,lastRebalancePrice:t}},P=(e,t,a)=>e-e*a-t,R=e=>new Intl.NumberFormat("en-US",{style:"percent",minimumFractionDigits:2}).format(e);function V(e){let{data:t,initialXPositionValue:a,selectedTimestamp:i}=e,[l,o]=(0,n.useState)(400),[c,d]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=()=>{let e=window.innerWidth;d(e<640),e<640?o(300):e<1024?o(400):o(500)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let m={labels:Array(t.length).fill(""),datasets:[{label:"ETH Price",data:t.map(e=>e.price),fill:!1,borderColor:"rgb(59, 130, 246)",pointRadius:e=>{if(!e.raw)return 3;let a=t[e.dataIndex];return a&&i&&a.timestamp===i?8:3},pointHoverRadius:5,pointStyle:"circle",pointBackgroundColor:e=>{if(!e.raw)return"rgb(59, 130, 246)";let a=t[e.dataIndex];return a&&i&&a.timestamp,"rgb(59, 130, 246)"},pointBorderColor:e=>{if(!e.raw)return"rgb(59, 130, 246)";let a=t[e.dataIndex];return a&&i&&a.timestamp===i?"white":"rgb(59, 130, 246)"},pointBorderWidth:e=>{if(!e.raw)return 1;let a=t[e.dataIndex];return a&&i&&a.timestamp===i?2:1},pointHoverBackgroundColor:"#ffffff"},{label:"Rebalance Line",data:t.map(e=>e.rebalanceLine),fill:!1,borderColor:"rgb(234, 179, 8)",pointRadius:e=>{if(!e.raw)return 3;let a=t[e.dataIndex];return a&&i&&a.timestamp===i?8:3},pointHoverRadius:5,pointStyle:"circle",pointBackgroundColor:e=>{if(!e.raw)return"rgb(234, 179, 8)";let a=t[e.dataIndex];return a&&i&&a.timestamp,"rgb(234, 179, 8)"},pointBorderColor:e=>{if(!e.raw)return"rgb(234, 179, 8)";let a=t[e.dataIndex];return a&&i&&a.timestamp===i?"white":"rgb(234, 179, 8)"},pointBorderWidth:e=>{if(!e.raw)return 1;let a=t[e.dataIndex];return a&&i&&a.timestamp===i?2:1},pointHoverBackgroundColor:"#ffffff"},{label:"Liquidation Line",data:t.map(e=>e.liquidationLine),fill:!1,borderColor:"rgb(239, 68, 68)",pointRadius:e=>{if(!e.raw)return 3;let a=t[e.dataIndex];return a&&i&&a.timestamp===i?8:3},pointHoverRadius:5,pointStyle:"circle",pointBackgroundColor:e=>{if(!e.raw)return"rgb(239, 68, 68)";let a=t[e.dataIndex];return a&&i&&a.timestamp,"rgb(239, 68, 68)"},pointBorderColor:e=>{if(!e.raw)return"rgb(239, 68, 68)";let a=t[e.dataIndex];return a&&i&&a.timestamp===i?"white":"rgb(239, 68, 68)"},pointBorderWidth:e=>{if(!e.raw)return 1;let a=t[e.dataIndex];return a&&i&&a.timestamp===i?2:1},pointHoverBackgroundColor:"#ffffff"}]};return(0,s.jsx)("div",{className:"w-full",style:{height:l,touchAction:"none"},children:(0,s.jsx)(r.N1,{data:m,options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{position:c?"bottom":"top",labels:{boxWidth:c?8:12,padding:c?10:20,font:{size:c?11:12}}},tooltip:{enabled:!0,mode:"index",intersect:!1,bodySpacing:4,titleFont:{size:c?12:14},bodyFont:{size:c?11:12},callbacks:{label:e=>{if(!e.raw)return"";let s=t[e.dataIndex];if(!s)return"";let n="".concat(e.dataset.label,": ").concat(y(e.parsed.y));if("ETH Price"===e.dataset.label){let e=s.debt/s.positionSize;return[n,"xPosition Value: ".concat(y(s.xPositionValue)),"Debt: ".concat(y(s.debt)),"Total Position Size: ".concat(y(s.positionSize)),"LTV: ".concat(R(e)),"PnL: ".concat(y(s.xPositionValue-(a||0))),"ETH Amount: ".concat(s.ethAmount.toFixed(6)," ETH")]}return n}}}},scales:{x:{display:!0,grid:{display:!0},ticks:{display:!1},title:{display:!1}},y:{display:!0,title:{display:!0,text:"Price (USD)"},ticks:{callback:e=>y(e)}}}}})})}i.t1.register(i.PP,i.kc,i.FN,i.No,i.hE,i.m_,i.s$);var T=a(9606),C=a(3415),F=a(2679),S=a(2317),L=a(3463),I=a(9795);function H(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,I.QP)((0,L.$)(t))}var E=a(6195),A=a(1027);let D=(0,A.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),B=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(E.b,{ref:t,className:H(D(),a),...n})});B.displayName=E.b.displayName;let M=T.Op,_=n.createContext({}),q=e=>{let{...t}=e;return(0,s.jsx)(_.Provider,{value:{name:t.name},children:(0,s.jsx)(T.xI,{...t})})},U=()=>{let e=n.useContext(_),t=n.useContext(W),{getFieldState:a,formState:s}=(0,T.xW)(),r=a(e.name,s);if(!e)throw Error("useFormField should be used within <FormField>");let{id:i}=t;return{id:i,name:e.name,formItemId:"".concat(i,"-form-item"),formDescriptionId:"".concat(i,"-form-item-description"),formMessageId:"".concat(i,"-form-item-message"),...r}},W=n.createContext({}),O=n.forwardRef((e,t)=>{let{className:a,...r}=e,i=n.useId();return(0,s.jsx)(W.Provider,{value:{id:i},children:(0,s.jsx)("div",{ref:t,className:H("space-y-2",a),...r})})});O.displayName="FormItem";let J=n.forwardRef((e,t)=>{let{className:a,...n}=e,{error:r,formItemId:i}=U();return(0,s.jsx)(B,{ref:t,className:H(r&&"text-red-500 dark:text-red-900",a),htmlFor:i,...n})});J.displayName="FormLabel";let X=n.forwardRef((e,t)=>{let{...a}=e,{error:n,formItemId:r,formDescriptionId:i,formMessageId:l}=U();return(0,s.jsx)(S.DX,{ref:t,id:r,"aria-describedby":n?"".concat(i," ").concat(l):"".concat(i),"aria-invalid":!!n,...a})});X.displayName="FormControl";let Q=n.forwardRef((e,t)=>{let{className:a,...n}=e,{formDescriptionId:r}=U();return(0,s.jsx)("p",{ref:t,id:r,className:H("text-[0.8rem] text-zinc-500 dark:text-zinc-400",a),...n})});Q.displayName="FormDescription";let $=n.forwardRef((e,t)=>{let{className:a,children:n,...r}=e,{error:i,formMessageId:l}=U(),o=i?String(null==i?void 0:i.message):n;return o?(0,s.jsx)("p",{ref:t,id:l,className:H("text-[0.8rem] font-medium text-red-500 dark:text-red-900",a),...r,children:o}):null});$.displayName="FormMessage";let Y=n.forwardRef((e,t)=>{let{className:a,type:n,...r}=e;return(0,s.jsx)("input",{type:n,className:H("flex h-9 w-full rounded-md border border-zinc-200 bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-zinc-950 placeholder:text-zinc-500 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-zinc-950 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm dark:border-zinc-800 dark:file:text-zinc-50 dark:placeholder:text-zinc-400 dark:focus-visible:ring-zinc-300",a),ref:t,...r})});Y.displayName="Input";var Z=a(5900);let G=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsxs)(Z.bL,{ref:t,className:H("relative flex w-full touch-none select-none items-center",a),...n,children:[(0,s.jsx)(Z.CC,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-zinc-900/20 dark:bg-zinc-50/20",children:(0,s.jsx)(Z.Q6,{className:"absolute h-full bg-zinc-900 dark:bg-zinc-50"})}),(0,s.jsx)(Z.zi,{className:"block h-4 w-4 rounded-full border border-zinc-200 border-zinc-900/50 bg-white shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-zinc-950 disabled:pointer-events-none disabled:opacity-50 dark:border-zinc-800 dark:border-zinc-50/50 dark:bg-zinc-950 dark:focus-visible:ring-zinc-300"})]})});G.displayName=Z.bL.displayName;let K=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("div",{ref:t,className:H("rounded-xl border border-zinc-200 bg-white text-zinc-950 shadow dark:border-zinc-800 dark:bg-zinc-950 dark:text-zinc-50",a),...n})});K.displayName="Card",n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("div",{ref:t,className:H("flex flex-col space-y-1.5 p-6",a),...n})}).displayName="CardHeader",n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("div",{ref:t,className:H("font-semibold leading-none tracking-tight",a),...n})}).displayName="CardTitle",n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("div",{ref:t,className:H("text-sm text-zinc-500 dark:text-zinc-400",a),...n})}).displayName="CardDescription",n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("div",{ref:t,className:H("p-6 pt-0",a),...n})}).displayName="CardContent",n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("div",{ref:t,className:H("flex items-center p-6 pt-0",a),...n})}).displayName="CardFooter";let ee=C.Ik({xPositionValue:C.ai().min(100).max(1e6),openingPrice:C.ai().min(100),leverage:C.ai().min(1).max(7)});function et(e){let{initialValues:t=o,onUpdate:a}=e,n=(0,T.mN)({resolver:(0,F.u)(ee),defaultValues:t,mode:"onChange"}),r=()=>{let e=n.getValues(),t={xPositionValue:Number(e.xPositionValue),openingPrice:Number(e.openingPrice),leverage:Number(e.leverage)};Number.isNaN(t.xPositionValue)||Number.isNaN(t.openingPrice)||Number.isNaN(t.leverage)||!ee.safeParse(t).success||a(t)},i=(e,t)=>{let a=parseFloat(t);Number.isNaN(a)||(e.onChange(a),r())},m=Number(n.watch("xPositionValue"))||0,x=Number(n.watch("openingPrice"))||0,u=c(m,Number(n.watch("leverage"))||1),p=d(m,u),b=g(p,x);return(0,s.jsx)(K,{className:"p-3 sm:p-6",children:(0,s.jsx)(M,{...n,children:(0,s.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[(0,s.jsx)(q,{control:n.control,name:"xPositionValue",render:e=>{let{field:t}=e;return(0,s.jsxs)(O,{className:"space-y-2 sm:space-y-3",children:[(0,s.jsx)(J,{className:"text-sm sm:text-base",children:"xPosition Value"}),(0,s.jsx)(X,{children:(0,s.jsx)(Y,{type:"number",placeholder:"10000",className:"h-10 sm:h-11 text-base sm:text-lg",...t,onChange:e=>i(t,e.target.value)})}),(0,s.jsxs)("div",{className:"space-y-1.5",children:[(0,s.jsxs)(Q,{className:"text-xs sm:text-sm",children:["Initial xPosition value ",y(t.value*(1-l.openingFee))]}),(0,s.jsxs)(Q,{className:"text-xs sm:text-sm",children:["Initial Debt: ",y(u)]}),(0,s.jsxs)(Q,{className:"text-xs sm:text-sm",children:["Total Position Size: ",y(p)]}),(0,s.jsxs)(Q,{className:"text-xs sm:text-sm",children:["Initial ETH Amount: ",b.toFixed(4)," ETH"]})]}),(0,s.jsx)($,{className:"text-xs sm:text-sm"})]})}}),(0,s.jsx)(q,{control:n.control,name:"openingPrice",render:e=>{let{field:t}=e;return(0,s.jsxs)(O,{className:"space-y-2 sm:space-y-3",children:[(0,s.jsx)(J,{className:"text-sm sm:text-base",children:"Opening Price"}),(0,s.jsx)(X,{children:(0,s.jsx)(Y,{type:"number",placeholder:"2920",className:"h-10 sm:h-11 text-base sm:text-lg",...t,onChange:e=>i(t,e.target.value)})}),(0,s.jsxs)(Q,{className:"text-xs sm:text-sm",children:["Initial ETH price (",y(t.value),")"]}),(0,s.jsx)($,{className:"text-xs sm:text-sm"})]})}}),(0,s.jsx)(q,{control:n.control,name:"leverage",render:e=>{let{field:t}=e;return(0,s.jsxs)(O,{className:"space-y-2 sm:space-y-3",children:[(0,s.jsxs)(J,{className:"text-sm sm:text-base",children:["Leverage ",(0,s.jsxs)("span",{className:"text-primary ml-1",children:["(",t.value,"x)"]})]}),(0,s.jsx)(X,{children:(0,s.jsx)("div",{className:"px-1 py-3 sm:py-4",children:(0,s.jsx)(G,{min:1,max:7,step:.1,value:[t.value],onValueChange:e=>{let[a]=e;t.onChange(a),r()},className:"h-6 sm:h-7"})})}),(0,s.jsx)(Q,{className:"text-xs sm:text-sm",children:(0,s.jsxs)("span",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:"Min: 1x"}),(0,s.jsx)("span",{children:"Max: 7x"})]})}),(0,s.jsx)($,{className:"text-xs sm:text-sm"})]})}})]})})})}function ea(e){let{constants:t}=e;return(0,s.jsxs)(K,{className:"p-3 sm:p-6",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Protocol Constants"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Opening Fee"}),(0,s.jsx)("span",{className:"font-medium",children:R(t.openingFee)})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Closing Fee"}),(0,s.jsx)("span",{className:"font-medium",children:R(t.closingFee)})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Rebalancing Bounty"}),(0,s.jsx)("span",{className:"font-medium",children:R(t.rebalancingBounty)})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Rebalance LTV"}),(0,s.jsx)("span",{className:"font-medium",children:R(t.rebalanceLTV)})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Liquidation LTV"}),(0,s.jsx)("span",{className:"font-medium",children:R(t.liquidationLTV)})]})]})]})}let es=(0,A.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-zinc-950 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 dark:focus-visible:ring-zinc-300",{variants:{variant:{default:"bg-zinc-900 text-zinc-50 shadow hover:bg-zinc-900/90 dark:bg-zinc-50 dark:text-zinc-900 dark:hover:bg-zinc-50/90",destructive:"bg-red-500 text-zinc-50 shadow-sm hover:bg-red-500/90 dark:bg-red-900 dark:text-zinc-50 dark:hover:bg-red-900/90",outline:"border border-zinc-200 bg-white shadow-sm hover:bg-zinc-100 hover:text-zinc-900 dark:border-zinc-800 dark:bg-zinc-950 dark:hover:bg-zinc-800 dark:hover:text-zinc-50",secondary:"bg-zinc-100 text-zinc-900 shadow-sm hover:bg-zinc-100/80 dark:bg-zinc-800 dark:text-zinc-50 dark:hover:bg-zinc-800/80",ghost:"hover:bg-zinc-100 hover:text-zinc-900 dark:hover:bg-zinc-800 dark:hover:text-zinc-50",link:"text-zinc-900 underline-offset-4 hover:underline dark:text-zinc-50"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),en=n.forwardRef((e,t)=>{let{className:a,variant:n,size:r,asChild:i=!1,...l}=e,o=i?S.DX:"button";return(0,s.jsx)(o,{className:H(es({variant:n,size:r,className:a})),ref:t,...l})});en.displayName="Button";var er=a(2795),ei=a(2517),el=a(6235),eo=a(4201),ec=a(2645),ed=a(2488),em=a(7193);let ex=eo.bL;eo.YJ;let eu=eo.WT,ep=n.forwardRef((e,t)=>{let{className:a,children:n,...r}=e;return(0,s.jsxs)(eo.l9,{ref:t,className:H("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-zinc-200 bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-white placeholder:text-zinc-500 focus:outline-none focus:ring-1 focus:ring-zinc-950 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1 dark:border-zinc-800 dark:ring-offset-zinc-950 dark:placeholder:text-zinc-400 dark:focus:ring-zinc-300",a),...r,children:[n,(0,s.jsx)(eo.In,{asChild:!0,children:(0,s.jsx)(ec.A,{className:"h-4 w-4 opacity-50"})})]})});ep.displayName=eo.l9.displayName;let eb=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(eo.PP,{ref:t,className:H("flex cursor-default items-center justify-center py-1",a),...n,children:(0,s.jsx)(ed.A,{className:"h-4 w-4"})})});eb.displayName=eo.PP.displayName;let ef=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(eo.wn,{ref:t,className:H("flex cursor-default items-center justify-center py-1",a),...n,children:(0,s.jsx)(ec.A,{className:"h-4 w-4"})})});ef.displayName=eo.wn.displayName;let eh=n.forwardRef((e,t)=>{let{className:a,children:n,position:r="popper",...i}=e;return(0,s.jsx)(eo.ZL,{children:(0,s.jsxs)(eo.UC,{ref:t,className:H("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border border-zinc-200 bg-white text-zinc-950 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-zinc-800 dark:bg-zinc-950 dark:text-zinc-50","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:r,...i,children:[(0,s.jsx)(eb,{}),(0,s.jsx)(eo.LM,{className:H("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:n}),(0,s.jsx)(ef,{})]})})});eh.displayName=eo.UC.displayName,n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(eo.JU,{ref:t,className:H("px-2 py-1.5 text-sm font-semibold",a),...n})}).displayName=eo.JU.displayName;let eg=n.forwardRef((e,t)=>{let{className:a,children:n,...r}=e;return(0,s.jsxs)(eo.q7,{ref:t,className:H("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-zinc-100 focus:text-zinc-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-zinc-800 dark:focus:text-zinc-50",a),...r,children:[(0,s.jsx)("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(eo.VF,{children:(0,s.jsx)(em.A,{className:"h-4 w-4"})})}),(0,s.jsx)(eo.p4,{children:n})]})});function eN(e){let{isSimulating:t,marketMode:a,onPlayPause:n,onReset:r,onMarketModeChange:i}=e;return(0,s.jsx)(K,{className:"p-3 sm:p-6",children:(0,s.jsxs)("div",{className:"flex items-center gap-3 sm:gap-4",children:[(0,s.jsx)(en,{variant:"outline",size:"icon",onClick:n,className:"w-12 h-12 sm:w-10 sm:h-10",children:t?(0,s.jsx)(er.A,{className:"h-5 w-5 sm:h-4 sm:w-4"}):(0,s.jsx)(ei.A,{className:"h-5 w-5 sm:h-4 sm:w-4"})}),(0,s.jsx)(en,{variant:"outline",size:"icon",onClick:r,className:"w-12 h-12 sm:w-10 sm:h-10",children:(0,s.jsx)(el.A,{className:"h-5 w-5 sm:h-4 sm:w-4"})}),(0,s.jsxs)(ex,{value:a,onValueChange:e=>i(e),children:[(0,s.jsx)(ep,{className:"flex-1 sm:flex-none sm:w-[180px] h-12 sm:h-10 text-base sm:text-sm",children:(0,s.jsx)(eu,{placeholder:"Select market mode"})}),(0,s.jsxs)(eh,{className:"flex-1 sm:flex-none sm:w-[180px]",children:[(0,s.jsx)(eg,{value:"bullish",className:"text-base sm:text-sm py-3 sm:py-2",children:"Uptrend"}),(0,s.jsx)(eg,{value:"flat",className:"text-base sm:text-sm py-3 sm:py-2",children:"Flat"}),(0,s.jsx)(eg,{value:"bearish",className:"text-base sm:text-sm py-3 sm:py-2",children:"Downtrend"})]})]})]})})}eg.displayName=eo.q7.displayName,n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(eo.wv,{ref:t,className:H("-mx-1 my-1 h-px bg-zinc-100 dark:bg-zinc-800",a),...n})}).displayName=eo.wv.displayName;let ev=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("div",{className:"relative w-full overflow-auto",children:(0,s.jsx)("table",{ref:t,className:H("w-full caption-bottom text-sm",a),...n})})});ev.displayName="Table";let ej=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("thead",{ref:t,className:H("[&_tr]:border-b",a),...n})});ej.displayName="TableHeader";let ew=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("tbody",{ref:t,className:H("[&_tr:last-child]:border-0",a),...n})});ew.displayName="TableBody",n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("tfoot",{ref:t,className:H("border-t bg-zinc-100/50 font-medium [&>tr]:last:border-b-0 dark:bg-zinc-800/50",a),...n})}).displayName="TableFooter";let ey=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("tr",{ref:t,className:H("border-b transition-colors hover:bg-zinc-100/50 data-[state=selected]:bg-zinc-100 dark:hover:bg-zinc-800/50 dark:data-[state=selected]:bg-zinc-800",a),...n})});ey.displayName="TableRow";let ez=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("th",{ref:t,className:H("h-10 px-2 text-left align-middle font-medium text-zinc-500 [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px] dark:text-zinc-400",a),...n})});ez.displayName="TableHead";let ek=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("td",{ref:t,className:H("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...n})});function eP(e){var t,a;let{events:n,selectedTimestamp:r,onSelectEvent:i,xPositionValue:o,priceHistory:c}=e,d=o*l.openingFee,m=(null!==(a=null===(t=c[c.length-1])||void 0===t?void 0:t.xPositionValue)&&void 0!==a?a:o)*l.closingFee;return(0,s.jsxs)("div",{className:"rounded-xl border bg-card text-card-foreground",children:[(0,s.jsxs)("div",{className:"flex flex-col space-y-1.5 p-3 pb-0 sm:p-6 sm:pb-0",children:[(0,s.jsx)("h3",{className:"font-semibold leading-none tracking-tight",children:"Position Fees"}),(0,s.jsxs)("div",{className:"space-y-1 py-0 pb-6",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Opening Fee"}),(0,s.jsx)("span",{className:"text-red-500 dark:text-red-400",children:y(d)})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Closing Fee"}),(0,s.jsx)("span",{className:"text-red-500 dark:text-red-400",children:y(m)})]})]})]}),(0,s.jsxs)("div",{className:"border-t",children:[(0,s.jsxs)("div",{className:"flex flex-col space-y-1.5 p-3 pb-0 sm:p-6 sm:pb-0",children:[(0,s.jsx)("h3",{className:"font-semibold leading-none tracking-tight",children:"Rebalancing Events"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Track position reductions during rebalancing"})]}),(0,s.jsx)("div",{className:"p-3 pt-0 sm:p-6 sm:pt-0",children:0===n.length?(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"No rebalancing events yet"}):(0,s.jsxs)(ev,{children:[(0,s.jsx)(ej,{children:(0,s.jsxs)(ey,{children:[(0,s.jsx)(ez,{children:"Execution Price"}),(0,s.jsx)(ez,{children:"Rebalanced"}),(0,s.jsx)(ez,{children:"Rebalance Fee"}),(0,s.jsx)(ez,{children:"Total"})]})}),(0,s.jsx)(ew,{children:n.map(e=>(0,s.jsxs)(ey,{className:"cursor-pointer hover:bg-accent/50 ".concat(e.timestamp===r?"bg-accent":""),onClick:()=>null==i?void 0:i(e.timestamp===r?null:e.timestamp),children:[(0,s.jsx)(ek,{children:y(e.price)}),(0,s.jsx)(ek,{className:"text-red-500 dark:text-red-400",children:y(e.debtToRebalance)}),(0,s.jsx)(ek,{className:"text-red-500 dark:text-red-400",children:y(e.fee)}),(0,s.jsx)(ek,{className:"font-medium text-red-500 dark:text-red-400",children:y(e.totalReduction)})]},e.timestamp))})]})})]})]})}function eR(){let[e,t]=(0,n.useState)({...o,constants:l,currentPrice:o.openingPrice,priceHistory:[],rebalancingEvents:[],isSimulating:!1,marketMode:"bullish"}),[a,r]=(0,n.useState)(null),i=(0,n.useCallback)(()=>{if(!e.openingPrice||!e.leverage||!e.xPositionValue)return[];let a=e.openingPrice,s=h(a,.05*a,1,60),n=[],r=[];return s.forEach((t,a)=>{let s=Date.now()-(60-a)*500,i=n[a-1],o=(null==i?void 0:i.wasRebalanced)?i.debt:void 0,c=null==i?void 0:i.ethAmount,d=v(e.xPositionValue,e.leverage,t,e.openingPrice,o,c),x={timestamp:s,price:t,xPositionValue:d.xPositionValue,initialDebt:d.initialDebt,debt:d.debt,positionSize:d.positionSize,ethAmount:d.ethAmount,wasRebalanced:(null==i?void 0:i.wasRebalanced)||!1,rebalancingAmount:(null==i?void 0:i.rebalancingAmount)||0,lastRebalancePrice:(null==i?void 0:i.lastRebalancePrice)||m(e.openingPrice,e.leverage,l.rebalanceLTV)};if(t<x.lastRebalancePrice){let a=z(x.positionSize,x.debt,e.constants.rebalanceLTV,e.constants.rebalancingBounty);x=k(x,t,e.constants.rebalanceLTV,e.constants.rebalancingBounty),a.debtToRebalance>0&&r.push({timestamp:s,price:t,debtToRebalance:a.debtToRebalance,fee:a.rebalancingFee,totalReduction:a.debtToRebalance+a.rebalancingFee,remainingPosition:a.newPositionSize})}let u=w(x,e.openingPrice,e.leverage,e.constants);n.push(u)}),t(e=>({...e,rebalancingEvents:r})),n},[e.openingPrice,e.xPositionValue,e.constants,e.leverage]);(0,n.useEffect)(()=>{let e=i();t(t=>{var a;return{...t,priceHistory:e,currentPrice:(null===(a=e[e.length-1])||void 0===a?void 0:a.price)||t.currentPrice}})},[i]),(0,n.useEffect)(()=>{if(!e.isSimulating)return;let a=setInterval(()=>{t(e=>{let t=e.priceHistory[e.priceHistory.length-1];if(!t)return e;let a=0;"flat"!==e.marketMode&&(a=.005*("bullish"===e.marketMode?1:-1));let s=t.price*(1+a),n=v(e.xPositionValue,e.leverage,s,e.openingPrice,t.wasRebalanced?t.debt:void 0,t.ethAmount),r={timestamp:Date.now(),price:s,xPositionValue:n.xPositionValue,initialDebt:n.initialDebt,debt:n.debt,positionSize:n.positionSize,ethAmount:n.ethAmount,wasRebalanced:t.wasRebalanced,rebalancingAmount:t.rebalancingAmount,lastRebalancePrice:t.lastRebalancePrice},i=[...e.rebalancingEvents];if(s<r.lastRebalancePrice){let t=z(r.positionSize,r.debt,e.constants.rebalanceLTV,e.constants.rebalancingBounty);r=k(r,s,e.constants.rebalanceLTV,e.constants.rebalancingBounty),t.debtToRebalance>0&&(i=[...i,{timestamp:Date.now(),price:s,debtToRebalance:t.debtToRebalance,fee:t.rebalancingFee,totalReduction:t.debtToRebalance+t.rebalancingFee,remainingPosition:t.newPositionSize}])}let l=w(r,e.openingPrice,e.leverage,e.constants),o=[...e.priceHistory.slice(-59),l];return{...e,currentPrice:s,priceHistory:o,rebalancingEvents:i}})},500);return()=>clearInterval(a)},[e.isSimulating]);let c=e=>{t(t=>{let a=j(t.openingPrice,e,t.constants);return{...t,leverage:e,priceHistory:t.priceHistory.map(s=>({...s,rebalanceLine:b(s,t.openingPrice,e,t.constants.rebalanceLTV),liquidationLine:f(s,t.openingPrice,e,t.constants.liquidationLTV,a)}))}})},d=e.priceHistory.length>0?P(e.priceHistory[e.priceHistory.length-1].xPositionValue,e.xPositionValue,e.constants.closingFee):0;return(0,s.jsxs)("div",{className:"container mx-auto px-4 sm:px-6 py-6 max-w-7xl space-y-6 sm:space-y-8",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center sm:items-center gap-4",children:[(0,s.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold tracking-tight",children:"f(x) Protocol Rebalancing Simulator"}),(0,s.jsxs)("div",{className:"w-full sm:w-auto inline-flex flex-col bg-card rounded-xl overflow-hidden border border-border",children:[(0,s.jsx)("div",{className:"px-4 sm:px-3 py-2 text-xs font-semibold uppercase tracking-wider text-muted-foreground text-center",children:"Current PnL"}),(0,s.jsx)("div",{className:"px-4 sm:px-3 py-2 sm:py-1.5 text-xl sm:text-lg font-bold tabular-nums text-center ".concat(d>=-.01?"text-green-600 dark:text-green-500":"text-red-600 dark:text-red-500"),children:y(d)})]})]}),(0,s.jsxs)("div",{className:"grid gap-6 sm:gap-8 grid-cols-1 lg:grid-cols-[2fr_1fr]",children:[(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsx)(V,{data:e.priceHistory,height:500,initialXPositionValue:e.xPositionValue,selectedTimestamp:a}),(0,s.jsx)(eN,{isSimulating:e.isSimulating,marketMode:e.marketMode,onPlayPause:()=>{t(e=>({...e,isSimulating:!e.isSimulating}))},onReset:()=>{t(e=>({...e,isSimulating:!1,priceHistory:i(),rebalancingEvents:[]})),r(null)},onMarketModeChange:e=>{t(t=>({...t,marketMode:e}))}}),(0,s.jsx)(eP,{events:e.rebalancingEvents,selectedTimestamp:a,onSelectEvent:r,xPositionValue:e.xPositionValue,priceHistory:e.priceHistory})]}),(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsx)(et,{initialValues:e,onUpdate:a=>{if(a.leverage!==e.leverage&&a.openingPrice===e.openingPrice&&a.xPositionValue===e.xPositionValue){c(a.leverage);return}t(e=>({...e,...a,priceHistory:[],rebalancingEvents:[]})),r(null)}}),(0,s.jsx)(ea,{constants:e.constants})]})]})]})}ek.displayName="TableCell",n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("caption",{ref:t,className:H("mt-4 text-sm text-zinc-500 dark:text-zinc-400",a),...n})}).displayName="TableCaption"}},e=>{var t=t=>e(e.s=t);e.O(0,[647,174,441,517,358],()=>t(741)),_N_E=e.O()}]);
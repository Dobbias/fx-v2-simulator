(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{741:(e,t,a)=>{Promise.resolve().then(a.bind(a,4567))},4567:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>eR});var n=a(5155),r=a(2115),s=a(6472),i=a(5781);let l={rebalanceLTV:.88,rebalancingBounty:.025,liquidationLTV:.95,openingFee:.003,closingFee:.001},o={xPositionValue:1e4,openingPrice:2e3,leverage:4},c=(e,t)=>e*(t-1),d=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.openingFee;return e-e*a+t},m=(e,t,a)=>e*(t-1)/(t*a),x=(e,t,a)=>e*(t-1)/(t*a),u=e=>e,p=(e,t)=>e-t,b=(e,t,a,n)=>e.wasRebalanced?u(e.lastRebalancePrice):m(t,a,n),f=(e,t,a,n,r)=>e.wasRebalanced&&void 0!==r?p(e.rebalanceLine,r):x(t,a,n),h=(e,t,a,n)=>Array.from({length:n},(a,r)=>e+t*Math.sin(r/(n-1)*2*Math.PI)),g=(e,t)=>e/t,N=(e,t)=>e*t,v=(e,t,a,n,r,s)=>{let i;let l=c(e,t),o=null!=r?r:l,m=N(i=s||g(d(e,l),n),a);return{initialDebt:l,debt:o,positionSize:m,ethAmount:i,xPositionValue:m-o}},j=(e,t,a)=>m(e,t,a.rebalanceLTV)-x(e,t,a.liquidationLTV),w=(e,t,a,n)=>{let r;let s=j(t,a,n),i=b(e,t,a,n.rebalanceLTV);return r=e.wasRebalanced?i-s:x(t,a,n.liquidationLTV),{...e,rebalanceLine:i,liquidationLine:r}},y=e=>(.01>Math.abs(e)&&(e=0),new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(e)),z=(e,t,a,n)=>{if(t/e<=a)return{debtToRebalance:0,newDebt:t,newPositionSize:e,rebalancingFee:0};let r=(t-e*a)/(1-(1+n)*a),s=Math.min(r*n,e-r);return{debtToRebalance:r,newDebt:t-r,newPositionSize:e-(r+s),rebalancingFee:s}},k=(e,t,a,n)=>{let{debtToRebalance:r,newDebt:s,newPositionSize:i,rebalancingFee:l}=z(e.positionSize,e.debt,a,n);return{...e,debt:s,positionSize:i,ethAmount:i/t,xPositionValue:i-s,wasRebalanced:!0,rebalancingAmount:r+l,lastRebalancePrice:t}},P=(e,t,a)=>e-e*a-t,R=e=>new Intl.NumberFormat("en-US",{style:"percent",minimumFractionDigits:2}).format(e);function T(e){let{data:t,initialXPositionValue:a,selectedTimestamp:i}=e,[l,o]=(0,r.useState)(400),[c,d]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=()=>{let e=window.innerWidth;d(e<640),e<640?o(300):e<1024?o(400):o(500)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let m={labels:Array(t.length).fill(""),datasets:[{label:"ETH Price",data:t.map(e=>e.price),fill:!1,borderColor:"rgb(59, 130, 246)",pointRadius:e=>{if(!e.raw)return 3;let a=t[e.dataIndex];return a&&i&&a.timestamp===i?8:3},pointHoverRadius:5,pointStyle:"circle",pointBackgroundColor:e=>{if(!e.raw)return"rgb(59, 130, 246)";let a=t[e.dataIndex];return a&&i&&a.timestamp,"rgb(59, 130, 246)"},pointBorderColor:e=>{if(!e.raw)return"rgb(59, 130, 246)";let a=t[e.dataIndex];return a&&i&&a.timestamp===i?"white":"rgb(59, 130, 246)"},pointBorderWidth:e=>{if(!e.raw)return 1;let a=t[e.dataIndex];return a&&i&&a.timestamp===i?2:1},pointHoverBackgroundColor:"#ffffff"},{label:"Rebalance Line",data:t.map(e=>e.rebalanceLine),fill:!1,borderColor:"rgb(234, 179, 8)",pointRadius:e=>{if(!e.raw)return 3;let a=t[e.dataIndex];return a&&i&&a.timestamp===i?8:3},pointHoverRadius:5,pointStyle:"circle",pointBackgroundColor:e=>{if(!e.raw)return"rgb(234, 179, 8)";let a=t[e.dataIndex];return a&&i&&a.timestamp,"rgb(234, 179, 8)"},pointBorderColor:e=>{if(!e.raw)return"rgb(234, 179, 8)";let a=t[e.dataIndex];return a&&i&&a.timestamp===i?"white":"rgb(234, 179, 8)"},pointBorderWidth:e=>{if(!e.raw)return 1;let a=t[e.dataIndex];return a&&i&&a.timestamp===i?2:1},pointHoverBackgroundColor:"#ffffff"},{label:"Liquidation Line",data:t.map(e=>e.liquidationLine),fill:!1,borderColor:"rgb(239, 68, 68)",pointRadius:e=>{if(!e.raw)return 3;let a=t[e.dataIndex];return a&&i&&a.timestamp===i?8:3},pointHoverRadius:5,pointStyle:"circle",pointBackgroundColor:e=>{if(!e.raw)return"rgb(239, 68, 68)";let a=t[e.dataIndex];return a&&i&&a.timestamp,"rgb(239, 68, 68)"},pointBorderColor:e=>{if(!e.raw)return"rgb(239, 68, 68)";let a=t[e.dataIndex];return a&&i&&a.timestamp===i?"white":"rgb(239, 68, 68)"},pointBorderWidth:e=>{if(!e.raw)return 1;let a=t[e.dataIndex];return a&&i&&a.timestamp===i?2:1},pointHoverBackgroundColor:"#ffffff"}]};return(0,n.jsx)("div",{className:"w-full",style:{height:l,touchAction:"none"},children:(0,n.jsx)(s.N1,{data:m,options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{position:c?"bottom":"top",labels:{boxWidth:c?8:12,padding:c?10:20,font:{size:c?11:12}}},tooltip:{enabled:!0,mode:"index",intersect:!1,bodySpacing:4,titleFont:{size:c?12:14},bodyFont:{size:c?11:12},callbacks:{label:e=>{if(!e.raw)return"";let n=t[e.dataIndex];if(!n)return"";let r="".concat(e.dataset.label,": ").concat(y(e.parsed.y));if("ETH Price"===e.dataset.label){let e=n.debt/n.positionSize;return[r,"xPosition Value: ".concat(y(n.xPositionValue)),"Debt: ".concat(y(n.debt)),"Total Position Size: ".concat(y(n.positionSize)),"LTV: ".concat(R(e)),"PnL: ".concat(y(n.xPositionValue-(a||0))),"ETH Amount: ".concat(n.ethAmount.toFixed(6)," ETH")]}return r}}}},scales:{x:{display:!0,grid:{display:!0},ticks:{display:!1},title:{display:!1}},y:{display:!0,title:{display:!0,text:"Price (USD)"},ticks:{callback:e=>y(e)}}}}})})}i.t1.register(i.PP,i.kc,i.FN,i.No,i.hE,i.m_,i.s$);var V=a(9606),C=a(3415),S=a(2679),F=a(2317),L=a(3463),I=a(9795);function H(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,I.QP)((0,L.$)(t))}var E=a(6195),A=a(1027);let B=(0,A.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),D=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(E.b,{ref:t,className:H(B(),a),...r})});D.displayName=E.b.displayName;let M=V.Op,_=r.createContext({}),q=e=>{let{...t}=e;return(0,n.jsx)(_.Provider,{value:{name:t.name},children:(0,n.jsx)(V.xI,{...t})})},U=()=>{let e=r.useContext(_),t=r.useContext(W),{getFieldState:a,formState:n}=(0,V.xW)(),s=a(e.name,n);if(!e)throw Error("useFormField should be used within <FormField>");let{id:i}=t;return{id:i,name:e.name,formItemId:"".concat(i,"-form-item"),formDescriptionId:"".concat(i,"-form-item-description"),formMessageId:"".concat(i,"-form-item-message"),...s}},W=r.createContext({}),O=r.forwardRef((e,t)=>{let{className:a,...s}=e,i=r.useId();return(0,n.jsx)(W.Provider,{value:{id:i},children:(0,n.jsx)("div",{ref:t,className:H("space-y-2",a),...s})})});O.displayName="FormItem";let J=r.forwardRef((e,t)=>{let{className:a,...r}=e,{error:s,formItemId:i}=U();return(0,n.jsx)(D,{ref:t,className:H(s&&"text-red-500 dark:text-red-900",a),htmlFor:i,...r})});J.displayName="FormLabel";let X=r.forwardRef((e,t)=>{let{...a}=e,{error:r,formItemId:s,formDescriptionId:i,formMessageId:l}=U();return(0,n.jsx)(F.DX,{ref:t,id:s,"aria-describedby":r?"".concat(i," ").concat(l):"".concat(i),"aria-invalid":!!r,...a})});X.displayName="FormControl";let Q=r.forwardRef((e,t)=>{let{className:a,...r}=e,{formDescriptionId:s}=U();return(0,n.jsx)("p",{ref:t,id:s,className:H("text-[0.8rem] text-zinc-500 dark:text-zinc-400",a),...r})});Q.displayName="FormDescription";let $=r.forwardRef((e,t)=>{let{className:a,children:r,...s}=e,{error:i,formMessageId:l}=U(),o=i?String(null==i?void 0:i.message):r;return o?(0,n.jsx)("p",{ref:t,id:l,className:H("text-[0.8rem] font-medium text-red-500 dark:text-red-900",a),...s,children:o}):null});$.displayName="FormMessage";let Y=r.forwardRef((e,t)=>{let{className:a,type:r,...s}=e;return(0,n.jsx)("input",{type:r,className:H("flex h-9 w-full rounded-md border border-zinc-200 bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-zinc-950 placeholder:text-zinc-500 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-zinc-950 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm dark:border-zinc-800 dark:file:text-zinc-50 dark:placeholder:text-zinc-400 dark:focus-visible:ring-zinc-300",a),ref:t,...s})});Y.displayName="Input";var Z=a(5900);let G=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsxs)(Z.bL,{ref:t,className:H("relative flex w-full touch-none select-none items-center",a),...r,children:[(0,n.jsx)(Z.CC,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-zinc-900/20 dark:bg-zinc-50/20",children:(0,n.jsx)(Z.Q6,{className:"absolute h-full bg-zinc-900 dark:bg-zinc-50"})}),(0,n.jsx)(Z.zi,{className:"block h-4 w-4 rounded-full border border-zinc-200 border-zinc-900/50 bg-white shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-zinc-950 disabled:pointer-events-none disabled:opacity-50 dark:border-zinc-800 dark:border-zinc-50/50 dark:bg-zinc-950 dark:focus-visible:ring-zinc-300"})]})});G.displayName=Z.bL.displayName;let K=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("div",{ref:t,className:H("rounded-xl border border-zinc-200 bg-white text-zinc-950 shadow dark:border-zinc-800 dark:bg-zinc-950 dark:text-zinc-50",a),...r})});K.displayName="Card",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("div",{ref:t,className:H("flex flex-col space-y-1.5 p-6",a),...r})}).displayName="CardHeader",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("div",{ref:t,className:H("font-semibold leading-none tracking-tight",a),...r})}).displayName="CardTitle",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("div",{ref:t,className:H("text-sm text-zinc-500 dark:text-zinc-400",a),...r})}).displayName="CardDescription",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("div",{ref:t,className:H("p-6 pt-0",a),...r})}).displayName="CardContent",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("div",{ref:t,className:H("flex items-center p-6 pt-0",a),...r})}).displayName="CardFooter";let ee=C.Ik({xPositionValue:C.ai().min(100).max(1e6),openingPrice:C.ai().min(100),leverage:C.ai().min(1).max(7)});function et(e){let{initialValues:t=o,onUpdate:a}=e,r=(0,V.mN)({resolver:(0,S.u)(ee),defaultValues:t,mode:"onChange"}),s=()=>{let e=r.getValues(),t={xPositionValue:Number(e.xPositionValue),openingPrice:Number(e.openingPrice),leverage:Number(e.leverage)};Number.isNaN(t.xPositionValue)||Number.isNaN(t.openingPrice)||Number.isNaN(t.leverage)||!ee.safeParse(t).success||a(t)},i=(e,t)=>{let a=parseFloat(t);Number.isNaN(a)||(e.onChange(a),s())},l=Number(r.watch("xPositionValue"))||0,m=Number(r.watch("openingPrice"))||0,x=c(l,Number(r.watch("leverage"))||1),u=d(l,x),p=g(u,m);return(0,n.jsx)(K,{className:"p-3 sm:p-6",children:(0,n.jsx)(M,{...r,children:(0,n.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[(0,n.jsx)(q,{control:r.control,name:"xPositionValue",render:e=>{let{field:t}=e;return(0,n.jsxs)(O,{className:"space-y-2 sm:space-y-3",children:[(0,n.jsx)(J,{className:"text-sm sm:text-base",children:"xPosition Value"}),(0,n.jsx)(X,{children:(0,n.jsx)(Y,{type:"number",placeholder:"10000",className:"h-10 sm:h-11 text-base sm:text-lg",...t,onChange:e=>i(t,e.target.value)})}),(0,n.jsxs)("div",{className:"space-y-1.5",children:[(0,n.jsxs)(Q,{className:"text-xs sm:text-sm",children:["Initial xPosition value (",y(t.value),")"]}),(0,n.jsxs)(Q,{className:"text-xs sm:text-sm",children:["Initial Debt: ",y(x)]}),(0,n.jsxs)(Q,{className:"text-xs sm:text-sm",children:["Total Position Size: ",y(u)]}),(0,n.jsxs)(Q,{className:"text-xs sm:text-sm",children:["Initial ETH Amount: ",p.toFixed(4)," ETH"]})]}),(0,n.jsx)($,{className:"text-xs sm:text-sm"})]})}}),(0,n.jsx)(q,{control:r.control,name:"openingPrice",render:e=>{let{field:t}=e;return(0,n.jsxs)(O,{className:"space-y-2 sm:space-y-3",children:[(0,n.jsx)(J,{className:"text-sm sm:text-base",children:"Opening Price"}),(0,n.jsx)(X,{children:(0,n.jsx)(Y,{type:"number",placeholder:"2920",className:"h-10 sm:h-11 text-base sm:text-lg",...t,onChange:e=>i(t,e.target.value)})}),(0,n.jsxs)(Q,{className:"text-xs sm:text-sm",children:["Initial ETH price (",y(t.value),")"]}),(0,n.jsx)($,{className:"text-xs sm:text-sm"})]})}}),(0,n.jsx)(q,{control:r.control,name:"leverage",render:e=>{let{field:t}=e;return(0,n.jsxs)(O,{className:"space-y-2 sm:space-y-3",children:[(0,n.jsxs)(J,{className:"text-sm sm:text-base",children:["Leverage ",(0,n.jsxs)("span",{className:"text-primary ml-1",children:["(",t.value,"x)"]})]}),(0,n.jsx)(X,{children:(0,n.jsx)("div",{className:"px-1 py-3 sm:py-4",children:(0,n.jsx)(G,{min:1,max:7,step:.1,value:[t.value],onValueChange:e=>{let[a]=e;t.onChange(a),s()},className:"h-6 sm:h-7"})})}),(0,n.jsx)(Q,{className:"text-xs sm:text-sm",children:(0,n.jsxs)("span",{className:"flex justify-between",children:[(0,n.jsx)("span",{children:"Min: 1x"}),(0,n.jsx)("span",{children:"Max: 7x"})]})}),(0,n.jsx)($,{className:"text-xs sm:text-sm"})]})}})]})})})}function ea(e){let{constants:t}=e;return(0,n.jsxs)(K,{className:"p-3 sm:p-6",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Protocol Constants"}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-muted-foreground",children:"Opening Fee"}),(0,n.jsx)("span",{className:"font-medium",children:R(t.openingFee)})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-muted-foreground",children:"Closing Fee"}),(0,n.jsx)("span",{className:"font-medium",children:R(t.closingFee)})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-muted-foreground",children:"Rebalancing Bounty"}),(0,n.jsx)("span",{className:"font-medium",children:R(t.rebalancingBounty)})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-muted-foreground",children:"Rebalance LTV"}),(0,n.jsx)("span",{className:"font-medium",children:R(t.rebalanceLTV)})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-muted-foreground",children:"Liquidation LTV"}),(0,n.jsx)("span",{className:"font-medium",children:R(t.liquidationLTV)})]})]})]})}let en=(0,A.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-zinc-950 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 dark:focus-visible:ring-zinc-300",{variants:{variant:{default:"bg-zinc-900 text-zinc-50 shadow hover:bg-zinc-900/90 dark:bg-zinc-50 dark:text-zinc-900 dark:hover:bg-zinc-50/90",destructive:"bg-red-500 text-zinc-50 shadow-sm hover:bg-red-500/90 dark:bg-red-900 dark:text-zinc-50 dark:hover:bg-red-900/90",outline:"border border-zinc-200 bg-white shadow-sm hover:bg-zinc-100 hover:text-zinc-900 dark:border-zinc-800 dark:bg-zinc-950 dark:hover:bg-zinc-800 dark:hover:text-zinc-50",secondary:"bg-zinc-100 text-zinc-900 shadow-sm hover:bg-zinc-100/80 dark:bg-zinc-800 dark:text-zinc-50 dark:hover:bg-zinc-800/80",ghost:"hover:bg-zinc-100 hover:text-zinc-900 dark:hover:bg-zinc-800 dark:hover:text-zinc-50",link:"text-zinc-900 underline-offset-4 hover:underline dark:text-zinc-50"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),er=r.forwardRef((e,t)=>{let{className:a,variant:r,size:s,asChild:i=!1,...l}=e,o=i?F.DX:"button";return(0,n.jsx)(o,{className:H(en({variant:r,size:s,className:a})),ref:t,...l})});er.displayName="Button";var es=a(2795),ei=a(2517),el=a(6235),eo=a(4201),ec=a(2645),ed=a(2488),em=a(7193);let ex=eo.bL;eo.YJ;let eu=eo.WT,ep=r.forwardRef((e,t)=>{let{className:a,children:r,...s}=e;return(0,n.jsxs)(eo.l9,{ref:t,className:H("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-zinc-200 bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-white placeholder:text-zinc-500 focus:outline-none focus:ring-1 focus:ring-zinc-950 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1 dark:border-zinc-800 dark:ring-offset-zinc-950 dark:placeholder:text-zinc-400 dark:focus:ring-zinc-300",a),...s,children:[r,(0,n.jsx)(eo.In,{asChild:!0,children:(0,n.jsx)(ec.A,{className:"h-4 w-4 opacity-50"})})]})});ep.displayName=eo.l9.displayName;let eb=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(eo.PP,{ref:t,className:H("flex cursor-default items-center justify-center py-1",a),...r,children:(0,n.jsx)(ed.A,{className:"h-4 w-4"})})});eb.displayName=eo.PP.displayName;let ef=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(eo.wn,{ref:t,className:H("flex cursor-default items-center justify-center py-1",a),...r,children:(0,n.jsx)(ec.A,{className:"h-4 w-4"})})});ef.displayName=eo.wn.displayName;let eh=r.forwardRef((e,t)=>{let{className:a,children:r,position:s="popper",...i}=e;return(0,n.jsx)(eo.ZL,{children:(0,n.jsxs)(eo.UC,{ref:t,className:H("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border border-zinc-200 bg-white text-zinc-950 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-zinc-800 dark:bg-zinc-950 dark:text-zinc-50","popper"===s&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:s,...i,children:[(0,n.jsx)(eb,{}),(0,n.jsx)(eo.LM,{className:H("p-1","popper"===s&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,n.jsx)(ef,{})]})})});eh.displayName=eo.UC.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(eo.JU,{ref:t,className:H("px-2 py-1.5 text-sm font-semibold",a),...r})}).displayName=eo.JU.displayName;let eg=r.forwardRef((e,t)=>{let{className:a,children:r,...s}=e;return(0,n.jsxs)(eo.q7,{ref:t,className:H("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-zinc-100 focus:text-zinc-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-zinc-800 dark:focus:text-zinc-50",a),...s,children:[(0,n.jsx)("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,n.jsx)(eo.VF,{children:(0,n.jsx)(em.A,{className:"h-4 w-4"})})}),(0,n.jsx)(eo.p4,{children:r})]})});function eN(e){let{isSimulating:t,marketMode:a,onPlayPause:r,onReset:s,onMarketModeChange:i}=e;return(0,n.jsx)(K,{className:"p-3 sm:p-6",children:(0,n.jsxs)("div",{className:"flex items-center gap-3 sm:gap-4",children:[(0,n.jsx)(er,{variant:"outline",size:"icon",onClick:r,className:"w-12 h-12 sm:w-10 sm:h-10",children:t?(0,n.jsx)(es.A,{className:"h-5 w-5 sm:h-4 sm:w-4"}):(0,n.jsx)(ei.A,{className:"h-5 w-5 sm:h-4 sm:w-4"})}),(0,n.jsx)(er,{variant:"outline",size:"icon",onClick:s,className:"w-12 h-12 sm:w-10 sm:h-10",children:(0,n.jsx)(el.A,{className:"h-5 w-5 sm:h-4 sm:w-4"})}),(0,n.jsxs)(ex,{value:a,onValueChange:e=>i(e),children:[(0,n.jsx)(ep,{className:"flex-1 sm:flex-none sm:w-[180px] h-12 sm:h-10 text-base sm:text-sm",children:(0,n.jsx)(eu,{placeholder:"Select market mode"})}),(0,n.jsxs)(eh,{className:"flex-1 sm:flex-none sm:w-[180px]",children:[(0,n.jsx)(eg,{value:"bullish",className:"text-base sm:text-sm py-3 sm:py-2",children:"Bullish"}),(0,n.jsx)(eg,{value:"flat",className:"text-base sm:text-sm py-3 sm:py-2",children:"Flat"}),(0,n.jsx)(eg,{value:"bearish",className:"text-base sm:text-sm py-3 sm:py-2",children:"Bearish"})]})]})]})})}eg.displayName=eo.q7.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(eo.wv,{ref:t,className:H("-mx-1 my-1 h-px bg-zinc-100 dark:bg-zinc-800",a),...r})}).displayName=eo.wv.displayName;let ev=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("div",{className:"relative w-full overflow-auto",children:(0,n.jsx)("table",{ref:t,className:H("w-full caption-bottom text-sm",a),...r})})});ev.displayName="Table";let ej=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("thead",{ref:t,className:H("[&_tr]:border-b",a),...r})});ej.displayName="TableHeader";let ew=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("tbody",{ref:t,className:H("[&_tr:last-child]:border-0",a),...r})});ew.displayName="TableBody",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("tfoot",{ref:t,className:H("border-t bg-zinc-100/50 font-medium [&>tr]:last:border-b-0 dark:bg-zinc-800/50",a),...r})}).displayName="TableFooter";let ey=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("tr",{ref:t,className:H("border-b transition-colors hover:bg-zinc-100/50 data-[state=selected]:bg-zinc-100 dark:hover:bg-zinc-800/50 dark:data-[state=selected]:bg-zinc-800",a),...r})});ey.displayName="TableRow";let ez=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("th",{ref:t,className:H("h-10 px-2 text-left align-middle font-medium text-zinc-500 [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px] dark:text-zinc-400",a),...r})});ez.displayName="TableHead";let ek=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("td",{ref:t,className:H("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...r})});function eP(e){let{events:t,selectedTimestamp:a,onSelectEvent:r}=e;if(0===t.length)return(0,n.jsx)("div",{className:"rounded-xl border bg-card text-card-foreground",children:(0,n.jsxs)("div",{className:"flex flex-col space-y-1.5 p-3 sm:p-6",children:[(0,n.jsx)("h3",{className:"font-semibold leading-none tracking-tight",children:"Rebalancing Events"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"No rebalancing events yet"})]})});let s=e=>{null==r||r(e===a?null:e)};return(0,n.jsxs)("div",{className:"rounded-xl border bg-card text-card-foreground",children:[(0,n.jsxs)("div",{className:"flex flex-col space-y-1.5 p-3 pb-0 sm:p-6 sm:pb-0",children:[(0,n.jsx)("h3",{className:"font-semibold leading-none tracking-tight",children:"Rebalancing Events"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"Track position reductions during rebalancing"})]}),(0,n.jsx)("div",{className:"p-3 pt-0 sm:p-6 sm:pt-0",children:(0,n.jsxs)(ev,{children:[(0,n.jsx)(ej,{children:(0,n.jsxs)(ey,{children:[(0,n.jsx)(ez,{children:"ETH Price"}),(0,n.jsx)(ez,{children:"Debt to Rebalance"}),(0,n.jsx)(ez,{children:"Rebalance Bounty"}),(0,n.jsx)(ez,{children:"Total"})]})}),(0,n.jsx)(ew,{children:t.map(e=>(0,n.jsxs)(ey,{className:"cursor-pointer hover:bg-accent/50 ".concat(e.timestamp===a?"bg-accent":""),onClick:()=>s(e.timestamp),children:[(0,n.jsx)(ek,{children:y(e.price)}),(0,n.jsx)(ek,{className:"text-red-500 dark:text-red-400",children:y(e.debtToRebalance)}),(0,n.jsx)(ek,{className:"text-red-500 dark:text-red-400",children:y(e.fee)}),(0,n.jsx)(ek,{className:"font-medium text-red-500 dark:text-red-400",children:y(e.totalReduction)})]},e.timestamp))})]})})]})}function eR(){let[e,t]=(0,r.useState)({...o,constants:l,currentPrice:o.openingPrice,priceHistory:[],rebalancingEvents:[],isSimulating:!1,marketMode:"bullish"}),[a,s]=(0,r.useState)(null),i=(0,r.useCallback)(()=>{if(!e.openingPrice||!e.leverage||!e.xPositionValue)return[];let a=e.openingPrice,n=h(a,.05*a,1,60),r=[],s=[];return n.forEach((t,a)=>{let n=Date.now()-(60-a)*500,i=r[a-1],o=(null==i?void 0:i.wasRebalanced)?i.debt:void 0,c=null==i?void 0:i.ethAmount,d=v(e.xPositionValue,e.leverage,t,e.openingPrice,o,c),x={timestamp:n,price:t,xPositionValue:d.xPositionValue,initialDebt:d.initialDebt,debt:d.debt,positionSize:d.positionSize,ethAmount:d.ethAmount,wasRebalanced:(null==i?void 0:i.wasRebalanced)||!1,rebalancingAmount:(null==i?void 0:i.rebalancingAmount)||0,lastRebalancePrice:(null==i?void 0:i.lastRebalancePrice)||m(e.openingPrice,e.leverage,l.rebalanceLTV)};if(t<x.lastRebalancePrice){let a=z(x.positionSize,x.debt,e.constants.rebalanceLTV,e.constants.rebalancingBounty);x=k(x,t,e.constants.rebalanceLTV,e.constants.rebalancingBounty),a.debtToRebalance>0&&s.push({timestamp:n,price:t,debtToRebalance:a.debtToRebalance,fee:a.rebalancingFee,totalReduction:a.debtToRebalance+a.rebalancingFee,remainingPosition:a.newPositionSize})}let u=w(x,e.openingPrice,e.leverage,e.constants);r.push(u)}),t(e=>({...e,rebalancingEvents:s})),r},[e.openingPrice,e.xPositionValue,e.constants,e.leverage]);(0,r.useEffect)(()=>{let e=i();t(t=>{var a;return{...t,priceHistory:e,currentPrice:(null===(a=e[e.length-1])||void 0===a?void 0:a.price)||t.currentPrice}})},[i]),(0,r.useEffect)(()=>{if(!e.isSimulating)return;let a=setInterval(()=>{t(e=>{let t=e.priceHistory[e.priceHistory.length-1];if(!t)return e;let a=0;"flat"!==e.marketMode&&(a=.005*("bullish"===e.marketMode?1:-1));let n=t.price*(1+a),r=v(e.xPositionValue,e.leverage,n,e.openingPrice,t.wasRebalanced?t.debt:void 0,t.ethAmount),s={timestamp:Date.now(),price:n,xPositionValue:r.xPositionValue,initialDebt:r.initialDebt,debt:r.debt,positionSize:r.positionSize,ethAmount:r.ethAmount,wasRebalanced:t.wasRebalanced,rebalancingAmount:t.rebalancingAmount,lastRebalancePrice:t.lastRebalancePrice},i=[...e.rebalancingEvents];if(n<s.lastRebalancePrice){let t=z(s.positionSize,s.debt,e.constants.rebalanceLTV,e.constants.rebalancingBounty);s=k(s,n,e.constants.rebalanceLTV,e.constants.rebalancingBounty),t.debtToRebalance>0&&(i=[...i,{timestamp:Date.now(),price:n,debtToRebalance:t.debtToRebalance,fee:t.rebalancingFee,totalReduction:t.debtToRebalance+t.rebalancingFee,remainingPosition:t.newPositionSize}])}let l=w(s,e.openingPrice,e.leverage,e.constants),o=[...e.priceHistory.slice(-59),l];return{...e,currentPrice:n,priceHistory:o,rebalancingEvents:i}})},500);return()=>clearInterval(a)},[e.isSimulating]);let c=e=>{t(t=>{let a=j(t.openingPrice,e,t.constants);return{...t,leverage:e,priceHistory:t.priceHistory.map(n=>({...n,rebalanceLine:b(n,t.openingPrice,e,t.constants.rebalanceLTV),liquidationLine:f(n,t.openingPrice,e,t.constants.liquidationLTV,a)}))}})},d=e.priceHistory.length>0?P(e.priceHistory[e.priceHistory.length-1].xPositionValue,e.xPositionValue,e.constants.closingFee):0;return(0,n.jsxs)("div",{className:"container mx-auto px-4 sm:px-6 py-6 max-w-7xl space-y-6 sm:space-y-8",children:[(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center sm:items-center gap-4",children:[(0,n.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold tracking-tight",children:"f(x) Protocol Rebalancing Simulator"}),(0,n.jsxs)("div",{className:"w-full sm:w-auto inline-flex flex-col bg-card rounded-xl overflow-hidden border border-border",children:[(0,n.jsx)("div",{className:"px-4 sm:px-3 py-2 text-xs font-semibold uppercase tracking-wider text-muted-foreground text-center",children:"Current PnL"}),(0,n.jsx)("div",{className:"px-4 sm:px-3 py-2 sm:py-1.5 text-xl sm:text-lg font-bold tabular-nums text-center ".concat(d>=-.01?"text-green-600 dark:text-green-500":"text-red-600 dark:text-red-500"),children:y(d)})]})]}),(0,n.jsxs)("div",{className:"grid gap-6 sm:gap-8 grid-cols-1 lg:grid-cols-[2fr_1fr]",children:[(0,n.jsxs)("div",{className:"space-y-8",children:[(0,n.jsx)(T,{data:e.priceHistory,height:500,initialXPositionValue:e.xPositionValue,selectedTimestamp:a}),(0,n.jsx)(eN,{isSimulating:e.isSimulating,marketMode:e.marketMode,onPlayPause:()=>{t(e=>({...e,isSimulating:!e.isSimulating}))},onReset:()=>{t(e=>({...e,isSimulating:!1,priceHistory:i(),rebalancingEvents:[]})),s(null)},onMarketModeChange:e=>{t(t=>({...t,marketMode:e}))}}),(0,n.jsx)(eP,{events:e.rebalancingEvents,selectedTimestamp:a,onSelectEvent:s})]}),(0,n.jsxs)("div",{className:"space-y-8",children:[(0,n.jsx)(et,{initialValues:e,onUpdate:a=>{if(a.leverage!==e.leverage&&a.openingPrice===e.openingPrice&&a.xPositionValue===e.xPositionValue){c(a.leverage);return}t(e=>({...e,...a,priceHistory:[],rebalancingEvents:[]})),s(null)}}),(0,n.jsx)(ea,{constants:e.constants})]})]})]})}ek.displayName="TableCell",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("caption",{ref:t,className:H("mt-4 text-sm text-zinc-500 dark:text-zinc-400",a),...r})}).displayName="TableCaption"}},e=>{var t=t=>e(e.s=t);e.O(0,[647,174,441,517,358],()=>t(741)),_N_E=e.O()}]);